<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ report_title | default('Report Summary') }}</title>

    <!-- Bootstrap (same CDN pattern used in index.html) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f5f7fa; color: #222; }
        .container { max-width: 1100px; margin-top: 36px; margin-bottom: 36px; }
        .card { border-radius: 12px; box-shadow: 0 6px 18px rgba(28, 41, 70, 0.06); }
        .metric { text-align: center; padding: 18px; }
        .metric .value { font-weight: 700; font-size: 1.6rem; }
        .metric .label { color: #6c757d; font-size: 0.9rem; }
        .section-title { font-size: 1.05rem; font-weight: 600; margin-bottom: 12px; }
        .small-muted { color: #6c757d; font-size: 0.9rem; }
        footer { text-align: center; color: #98a0ad; font-size: 0.85rem; margin-top: 24px; }
        pre.report-text { white-space: pre-wrap; word-wrap: break-word; background: #fff; padding: 12px; border-radius: 8px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card p-4 mb-4">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <h1 class="h3 mb-1">{{ report_title | default('Wonderful Report Summary') }}</h1>
                    <div class="small-muted">{{ report_subtitle | default('A concise summary of findings and recommendations') }}</div>
                </div>
                <div class="text-end small-muted">
                    <div>{{ report_date | default("{{ now() }}") }}</div>
                    <div>{{ author | default('Automated Report') }}</div>
                </div>
            </div>

            <hr>

            <div class="row g-3">
                <div class="col-12 col-md-8">
                    <div class="section-title">Executive Summary</div>
                    <div class="mb-3">
                        <pre class="report-text">{{ executive_summary | default('No executive summary provided. This area highlights the most important conclusions, high-level metrics, and next steps for stakeholders.') }}</pre>
                    </div>

                    <div class="row g-3">
                        <div class="col-12 col-lg-6">
                            <div class="section-title">Key Findings</div>
                            <ul>
                                {% for item in findings %}
                                    <li><strong>{{ item.title }}</strong>{% if item.detail %}: {{ item.detail }}{% endif %}</li>
                                {% else %}
                                    <li>No findings available.</li>
                                {% endfor %}
                            </ul>
                        </div>

                        <div class="col-12 col-lg-6">
                            <div class="section-title">Top Recommendations</div>
                            <ol>
                                {% for rec in recommendations %}
                                    <li>{{ rec }}</li>
                                {% else %}
                                    <li>No recommendations yet.</li>
                                {% endfor %}
                            </ol>
                        </div>
                    </div>

                    <div class="mt-3">
                        <div class="section-title">Detailed Notes</div>
                        <div class="card p-3">
                            {{ notes | default('Add detailed notes, logs, or analysis here.') }}
                        </div>
                    </div>
                </div>

                <div class="col-12 col-md-4">
                    <div class="section-title">Key Metrics</div>
                    <div class="card p-3 mb-3">
                        <div class="row g-2">
                            {% for key, value in metrics.items() if metrics %}
                                <div class="col-6">
                                    <div class="metric">
                                        <div class="value">{{ value }}</div>
                                        <div class="label">{{ key }}</div>
                                    </div>
                                </div>
                            {% endfor %}

                            {% if not metrics %}
                                <div class="col-12 small-muted">No metrics provided.</div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="section-title">Charts</div>
                    <div class="card p-3 mb-3">
                        <canvas id="metricsChart" style="width:100%;height:180px"></canvas>
                    </div>

                    <div class="section-title">Summary Table</div>
                    <div class="card p-2">
                        <table class="table table-sm mb-0">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th class="text-end">Value</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for row in summary_table %}
                                    <tr>
                                        <td>{{ row.label }}</td>
                                        <td class="text-end">{{ row.value }}</td>
                                    </tr>
                                {% else %}
                                    <tr><td colspan="2" class="small-muted">No table data.</td></tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <hr>
            <div class="d-flex justify-content-between small-muted">
                <div>Generated by Unit6 - GenAI</div>
                <div>Version: {{ version | default('1.0') }}</div>
            </div>
        </div>

        <footer>
            <div>For full details, consult the attached dataset and analysis notes.</div>
        </footer>
    </div>

    <!-- Optional JS for charts (only activates if JSON is provided) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script>
        // metrics_chart_json and trend_chart_json should be JSON arrays/objects passed safely from the server.
        // Example usage in Flask: render_template('summary.html', metrics_chart_json=json.dumps({labels: [...], datasets: [...] }))
        const metricsChartJson = {{ metrics_chart_json | default('null') | safe }};

        if (metricsChartJson) {
            try {
                const ctx = document.getElementById('metricsChart').getContext('2d');
                // Attempt to build a simple bar/line mix if the provided JSON matches Chart.js dataset format
                new Chart(ctx, metricsChartJson);
            } catch (e) {
                console.warn('Could not render metrics chart:', e);
            }
        } else {
            // Draw a friendly placeholder
            const ctx = document.getElementById('metricsChart').getContext('2d');
            ctx.fillStyle = '#f1f3f5';
            ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);
            ctx.fillStyle = '#adb5bd';
            ctx.font = '14px sans-serif';
            ctx.fillText('No chart data provided', 12, 22);
        }
    </script>
</body>
</html>

